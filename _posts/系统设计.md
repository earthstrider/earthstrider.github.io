系统设计

The process of defining the architecture, component, module, interfaces, and data for a system to satisfy specified requirements.



设计一个音乐推荐系统

SNAKE原则



## 宏观设计

#### 场景 Scenario

第一步：枚举

- 登陆注册
- 播放音乐
- 音乐推荐

第二步：排序，确定优先级

- 基本需求：播放音乐

- 加分需求：音乐推荐



#### 限制 Necessary

**用户**

- 假设日活用户 = 10M；

- 平均并发用户 = 日活用户 / 每日秒数 $$*$$ 平均在线时长；

- 高峰并发用户 = 平均并发用户 $$*$$ 6；

- 3个月后高峰并发用户 = 高峰并发用户 $$*$$ 2。(大约2500K用户)

**流量**

- 假设单用户流量 = 128Kbps；

- 3个月后高峰流量=2500,000$$*$$ 128Kbps=320Gbps。

**内存**

- 单用户内存=10KB；
- 3个月后内存=10,000,000 $$*$$ 2 $$*$$ 10 = 200GB

**存储**

- 音乐数 = 1,000,000
- 总存储 = 音乐数目 $$*$$ 单音乐  = 1,000,000 $$*$$ 15MB = 15TB



####  应用 Application



#### 数据 Kilobit



#### 进化 Evolve

方向

更好：限制

更广：场景

根深：细节



角度

性能/扩展/健壮性



## 微观设计

**提高性能**

计算u1和其他所有用户之间的复杂性

<img src="/Users/yanyong/Library/Application Support/typora-user-images/image-20190816203651832.png" width="70%"/>

如果对用户索引，复杂度$$O(n*m*m)$$，但是对电影索引，复杂度$$O(m*n)$$，降到平方级。



**提高健壮性**

微服务架构